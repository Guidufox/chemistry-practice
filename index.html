<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trucos Esenciales de Qu√≠mica</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n de Fuentes y Colores -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0f766e', // Teal-700
                        'secondary': '#ccfbf1', // Teal-100
                        'accent': '#d97706', // Amber-700
                        'darkblue': '#1e40af', // Blue-800
                        'warning': '#dc2626', // Red-600
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Estilos personalizados para legibilidad y est√©tica */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdfa; /* Teal-50 */
        }
        .card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-4px);
        }
        /* Estilos para KaTeX (evita que los elementos de math se rompan) */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5rem 0;
            text-align: center;
        }
        .formula-box {
            background-color: #e0f2f1; /* Teal-100 */
            border-left: 5px solid #0f766e; /* primary */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .mnemo {
            font-weight: bold;
            color: #d97706; /* accent */
            background-color: #fef3c7; /* Amber-100 */
            padding: 0.5rem;
            border-radius: 0.5rem;
            border-left: 4px solid #d97706;
        }
    </style>
    <!-- Carga de KaTeX CSS y JS para renderizar f√≥rmulas matem√°ticas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" xintegrity="sha384-GvrFq2tJ0t0WbTj1C9l6k6H/T5k0h3S5/E+2w==" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" xintegrity="sha384-Fp/mKqW8v1B0yYg0k4F9h1D+xXG5G/L7F3zR5W5F9u+4W9J" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" xintegrity="sha384-vK1YwJb0S4wF7S9J9W4R7D8G5L5H5H8J4G9K8F7L7J9W4R7" crossorigin="anonymous"></script>
</head>
<body class="p-4 md:p-8">
    <header class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-extrabold text-primary mb-2">
            Qu√≠mica ¬°El Kit de Supervivencia!
        </h1>
        <p class="text-xl text-gray-600">Trucos, F√≥rmulas y Ayudas de IA para Estequiometr√≠a, REDOX y Conceptos Clave.</p>

        <!-- **Aviso Importante de la IA** -->
        <div id="ai-notice" class="mt-4 p-3 bg-red-100 border-l-4 border-warning text-warning text-sm font-medium rounded-lg shadow-md max-w-2xl mx-auto hidden">
            <p>
                ‚ö†Ô∏è **Aviso de Herramientas de IA:** Para que las funciones de "Calculadora" y "Generador de Preguntas" funcionen, esta p√°gina debe ejecutarse en un entorno que provea la clave de API de Gemini. **No funcionar√° al abrirlo directamente en tu navegador.**
            </p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- SECCI√ìN 1: THETA y NORMALIDAD -->
        <div class="card bg-white p-6 rounded-xl border-t-4 border-primary lg:col-span-1">
            <h2 class="text-2xl font-bold text-primary mb-4 flex items-center">
                $\theta$ (Theta) & Normalidad
                <span class="ml-2 text-3xl">üß™</span>
            </h2>
            <p class="mb-4 text-gray-700 font-semibold">
                $\theta$ es clave para $N$ ($N = M \cdot \theta$).
            </p>

            <div class="space-y-4 text-sm">
                <p class="p-2 bg-secondary rounded-lg">
                    **√Åcidos (H...)**: $\theta = \text{N¬∫ de H}$. (Ej: $\text{H}_3\text{PO}_4 \rightarrow \theta = 3$)
                </p>
                <p class="p-2 bg-secondary rounded-lg">
                    **Bases (...OH)**: $\theta = \text{N¬∫ de (OH)}$. (Ej: $\text{Ca}(\text{OH})_2 \rightarrow \theta = 2$)
                </p>
                <p class="p-2 bg-secondary rounded-lg">
                    **Sales**: $\theta = \text{Carga total del metal}$. (Ej: $\text{Fe}_2(\text{SO}_4)_3 \rightarrow \text{Fe}^{+3} \rightarrow \theta = 3$)
                </p>
            </div>

            <div class="mt-6 p-4 bg-primary/10 rounded-xl border-l-4 border-primary">
                <h3 class="font-bold text-xl text-primary mb-3">‚ú® Calculadora de $\theta$ con IA</h3>
                <input type="text" id="formulaInput" placeholder="Ej: H2SO4 o Al(OH)3" class="w-full p-2 border border-primary/50 rounded-lg mb-2 text-sm focus:ring-primary focus:border-primary">
                <button id="calculateThetaBtn" class="w-full bg-primary text-white font-bold py-2 rounded-lg text-sm hover:bg-primary/80 transition duration-150">
                    Calcular y Explicar $\theta$
                </button>
                <div id="thetaResult" class="mt-3 text-gray-800 bg-white p-3 rounded-lg border border-primary/20 min-h-[50px] text-xs">
                    <p class="text-gray-500">Introduce una f√≥rmula y haz clic para ver el c√°lculo paso a paso.</p>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 2: REDOX y ELECTROQU√çMICA -->
        <div class="card bg-white p-6 rounded-xl border-t-4 border-accent lg:col-span-1">
            <h2 class="text-2xl font-bold text-accent mb-4 flex items-center">
                REDOX y Leyes de Faraday
                <span class="ml-2 text-3xl">‚ö°</span>
            </h2>

            <h3 class="font-semibold text-lg text-accent mb-2">1. C√°lculo de Voltaje</h3>
            <div class="formula-box bg-amber-50">
                <p class="font-mono text-center text-lg text-accent">
                    $$E^\circ_{\text{celda}} = E^\circ_{\text{MAYOR}} - E^\circ_{\text{MENOR}}$$
                </p>
            </div>
            <p class="text-xs italic text-gray-600 mb-4">
                El $E^\circ$ **MENOR** es el √Ånodo (Oxidaci√≥n).
            </p>

            <h3 class="font-semibold text-lg text-accent mb-2">2. Leyes de Faraday</h3>
            <div class="formula-box bg-amber-50">
                 <p class="font-mono text-center text-lg text-accent">
                    $$m = \frac{M \cdot I \cdot t}{n \cdot F}$$
                </p>
            </div>
            <p class="text-xs font-bold text-red-600 mb-4">
                ¬°IMPORTANTE!: $t$ debe estar en **segundos (s)** y $F = 96500 \text{ C/mol e}^-$.
            </p>

            <div class="mt-6 p-4 bg-accent/10 rounded-xl border-l-4 border-accent">
                <h3 class="font-bold text-xl text-accent mb-3">‚ú® Generador de Preguntas REDOX</h3>
                <button id="generateRedoxQuizBtn" class="w-full bg-accent text-white font-bold py-2 rounded-lg text-sm hover:bg-accent/80 transition duration-150">
                    Generar Problema de Pr√°ctica
                </button>
                <div id="quizResult" class="mt-3 text-gray-800 bg-white p-3 rounded-lg border border-accent/20 min-h-[50px] text-xs">
                    <p class="text-gray-500">Haz clic para generar una pregunta de REDOX/Electr√≥lisis con su soluci√≥n.</p>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 3: ESTEQUIOMETR√çA y F√ìRMULAS -->
        <div class="card bg-white p-6 rounded-xl border-t-4 border-darkblue lg:col-span-1">
            <h2 class="text-2xl font-bold text-darkblue mb-4 flex items-center">
                Estequiometr√≠a & F√≥rmulas
                <span class="ml-2 text-3xl">üìê</span>
            </h2>

            <h3 class="font-semibold text-lg text-darkblue mb-2">1. Conversi√≥n Moles/Masa</h3>
            <div class="formula-box bg-blue-50">
                 <p class="font-mono text-center text-lg text-darkblue">
                    $$\text{Moles} = \frac{\text{Masa (g)}}{\text{Masa Molar (PM)}}$$
                </p>
            </div>
            <p class="text-xs font-bold text-red-600 mb-4">
                ¬°Recuerda! Siempre convierte $mL$ a $L$ si usas Molaridad ($M$).
            </p>
            
            <h3 class="font-semibold text-lg text-darkblue mb-2">2. F√≥rmulas Emp√≠ricas y Moleculares</h3>
            <ol class="list-decimal ml-4 text-sm text-gray-700 space-y-1 mb-4">
                <li>**% a g:** Asume 100 g.</li>
                <li>**g a moles:** Divide g por el PM.</li>
                <li>**FE:** Divide todos los moles por el menor.</li>
                <li>**FM:** $\text{Factor} = \frac{\text{PM Molecular}}{\text{PM Emp√≠rico}}$</li>
            </ol>

            <div class="mt-6 p-4 bg-darkblue/10 rounded-xl border-l-4 border-darkblue">
                <h3 class="font-bold text-xl text-darkblue mb-3">‚ú® Calculadora de F√≥rmulas Emp√≠ricas</h3>
                <input type="text" id="empiricalFormulaInput" placeholder="Ej: 40.9%C, 4.59%H, 54.51%O" class="w-full p-2 border border-darkblue/50 rounded-lg mb-2 text-sm focus:ring-darkblue focus:border-darkblue">
                <button id="calculateEmpiricalBtn" class="w-full bg-darkblue text-white font-bold py-2 rounded-lg text-sm hover:bg-darkblue/80 transition duration-150">
                    Calcular F√≥rmula Emp√≠rica
                </button>
                <div id="empiricalResult" class="mt-3 text-gray-800 bg-white p-3 rounded-lg border border-darkblue/20 min-h-[50px] text-xs">
                    <p class="text-gray-500">Introduce los porcentajes y calcula la f√≥rmula emp√≠rica (usa el formato "%C, %H, ...").</p>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN 4: PROPIEDADES PERI√ìDICAS Y ENLACES (En dos columnas) -->
        <div class="card bg-white p-6 rounded-xl border-t-4 border-green-600 lg:col-span-3">
            <h2 class="text-2xl font-bold text-green-600 mb-4 flex items-center">
                Estructura At√≥mica y Enlaces
                <span class="ml-2 text-3xl">‚öõÔ∏è</span>
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Columna 1: Propiedades Peri√≥dicas -->
                <div>
                    <h3 class="font-semibold text-lg text-green-700 mb-2">1. Tendencias Peri√≥dicas</h3>
                    <table class="w-full text-sm mt-2 border border-green-200 rounded-lg overflow-hidden">
                        <thead>
                            <tr class="bg-green-100 text-green-800">
                                <th class="p-2 text-left">Propiedad</th>
                                <th class="p-2">Periodo ($\rightarrow$)</th>
                                <th class="p-2">Grupo ($\downarrow$)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="p-2 font-medium">Radio At√≥mico (Tama√±o)</td>
                                <td class="p-2 text-red-600">Disminuye ($\downarrow$)</td>
                                <td class="p-2 text-primary">Aumenta ($\uparrow$)</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-2 font-medium">Energ√≠a de Ionizaci√≥n ($\text{EI}$)</td>
                                <td class="p-2 text-primary">Aumenta ($\uparrow$)</td>
                                <td class="p-2 text-red-600">Disminuye ($\downarrow$)</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-medium">Electronegatividad ($\text{EN}$)</td>
                                <td class="p-2 text-primary">Aumenta ($\uparrow$)</td>
                                <td class="p-2 text-red-600">Disminuye ($\downarrow$)</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="text-xs mt-2 italic text-gray-600">
                        Fl√∫or (F) es el m√°s electronegativo; Cesio (Cs) tiene la menor Energ√≠a de Ionizaci√≥n.                     </p>
                </div>
                
                <!-- Columna 2: Enlaces y Estructura -->
                <div>
                    <h3 class="font-semibold text-lg text-green-700 mb-2">2. Enlaces (Por $\Delta \text{EN}$)</h3>
                    <ul class="list-disc ml-4 text-sm text-gray-700 space-y-2">
                        <li>**I√≥nico:** $\Delta \text{EN} > 1.7$ (Metal + No Metal, o $\text{NH}_4^+$). S√≥lido duro, conduce fundido.</li>
                        <li>**Covalente Polar:** $0.4 < \Delta \text{EN} < 1.7$ (Comparten $e^-$ de forma desigual).</li>
                        <li>**Covalente No Polar:** $\Delta \text{EN} < 0.4$ (Comparten $e^-$ de forma igual).</li>
                    </ul>

                    <h3 class="font-semibold text-lg text-green-700 mt-4 mb-2">3. Configuraci√≥n Electr√≥nica</h3>
                    <div class="bg-green-50 p-3 rounded-lg text-sm">
                        <p class="font-mono text-xs break-all text-green-800">
                            $1s^2, 2s^2, 2p^6, 3s^2, 3p^6, 4s^2, 3d^{10}, 4p^6, 5s^2, 4d^{10}, 5p^6 \ldots$
                        </p>
                        <p class="text-xs mt-1 text-gray-600">
                            El **Periodo** es el $n$ m√°s alto.
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
    <footer class="mt-10 pt-6 border-t border-gray-300 text-center text-gray-500 text-sm">
        <p>Resumen de estudio y herramientas de IA integradas. ¬°A conquistar el examen!</p>
    </footer>

    <!-- Script para KaTeX y LLM (Funcionalidad de IA) -->
    <script>
        // --- Constantes de la API de Gemini ---
        // Nota: La apiKey se deja vac√≠a. En entornos compatibles (como este), se inyecta autom√°ticamente. 
        // Si el usuario abre el HTML localmente, fallar√°, por eso se a√±ade el aviso visual.
        const apiKey = ""; 
        const modelName = "gemini-2.5-flash-preview-09-2025";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        // --- Funci√≥n de utilidad para llamadas a la API de Gemini con retroceso exponencial ---
        async function callGeminiApi(systemInstruction, userQuery) {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                },
                tools: [{ "google_search": {} }],
            };

            let attempt = 0;
            const maxAttempts = 5;

            while (attempt < maxAttempts) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && attempt < maxAttempts - 1) {
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                            // Silently retry, do not log to console for clean user experience
                            await new Promise(resolve => setTimeout(resolve, delay));
                            attempt++;
                            continue;
                        }
                        // Explicit error message for the user
                        const errorMsg = `Error: La llamada a la API fall√≥ con estado ${response.status}. Verifica el aviso de la IA.`;
                        console.error("Gemini API error:", errorMsg);
                        return errorMsg;
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: No se pudo obtener la respuesta de la IA. Posiblemente la clave de API no est√° disponible.";
                    return text;

                } catch (error) {
                    // This catches network errors, CORS issues, etc.
                    console.error("Gemini API network error:", error);
                    return "Error de conexi√≥n de red o entorno. Aseg√∫rate de que la p√°gina se ejecute en un entorno compatible (ej. Canvas, no local).";
                }
            }
            return "Error: Se excedi√≥ el n√∫mero m√°ximo de reintentos.";
        }

        // --- L√≥gica principal de la aplicaci√≥n ---
        document.addEventListener("DOMContentLoaded", function() {
            // Mostrar aviso si la API Key NO est√° presente (asumiendo ejecuci√≥n local)
            const aiNotice = document.getElementById('ai-notice');
            if (!apiKey) {
                aiNotice.classList.remove('hidden');
            }

            // Inicializa KaTeX
            const katexConfig = {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false},
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ],
                throwOnError : false
            };
            // Funci√≥n para renderizar el contenido matem√°tico
            const renderMath = (element) => {
                 try {
                    renderMathInElement(element, katexConfig);
                 } catch (e) {
                     console.error("Error rendering KaTeX:", e);
                 }
            };

            renderMath(document.body);

            // --- 1. L√≥gica del Calculador de Theta con IA ---
            const calculateThetaBtn = document.getElementById('calculateThetaBtn');
            const formulaInput = document.getElementById('formulaInput');
            const thetaResult = document.getElementById('thetaResult');

            if (calculateThetaBtn) {
                calculateThetaBtn.addEventListener('click', async () => {
                    const formula = formulaInput.value.trim();
                    if (!formula) {
                        thetaResult.innerHTML = "<p class='text-warning'>Por favor, introduce una f√≥rmula qu√≠mica.</p>";
                        return;
                    }

                    thetaResult.innerHTML = `<p class='text-primary'>Calculando $\theta$ para <b>${formula}</b>... </p>`;
                    calculateThetaBtn.disabled = true;

                    const systemPrompt = `Act√∫a como un profesor de qu√≠mica enfocado en el factor de equivalencia (theta). Tu tarea es analizar la f√≥rmula qu√≠mica proporcionada por el usuario y determinar su factor de equivalencia (theta, $\theta$), siguiendo estrictamente estas reglas: 1. Si es un √Åcido (empieza con H, como H2SO4): $\theta$ es igual al n√∫mero de hidr√≥genos. 2. Si es una Base (termina en OH, como Ca(OH)2): $\theta$ es igual al n√∫mero de grupos hidroxilo (OH). 3. Si es una Sal (Metal + No Metal, como NaCl o Fe2(SO4)3): $\theta$ es igual a la carga total del metal (ignora el signo). 4. Explica el paso a paso. Utiliza KaTeX para las f√≥rmulas matem√°ticas, por ejemplo: $H_2SO_4 \\rightarrow \\theta=2$.`;

                    const userQuery = `Analiza la siguiente f√≥rmula qu√≠mica y calcula su factor de equivalencia $\theta$: ${formula}`;
                    
                    try {
                        const resultText = await callGeminiApi(systemPrompt, userQuery);
                        thetaResult.innerHTML = resultText;
                        renderMath(thetaResult);
                    } catch (error) {
                        // Managed inside callGeminiApi, but good to have fallback
                        thetaResult.innerHTML = "<p class='text-warning'>Error al calcular. Revisa la consola o el aviso de la IA.</p>";
                    } finally {
                        calculateThetaBtn.disabled = false;
                    }
                });
            }

            // --- 2. L√≥gica del Generador de Preguntas REDOX con IA ---
            const generateRedoxQuizBtn = document.getElementById('generateRedoxQuizBtn');
            const quizResult = document.getElementById('quizResult');

            if (generateRedoxQuizBtn) {
                generateRedoxQuizBtn.addEventListener('click', async () => {
                    quizResult.innerHTML = `<p class='text-accent'>Generando pregunta REDOX... </p>`;
                    generateRedoxQuizBtn.disabled = true;

                    const systemPrompt = `Eres un tutor de electroqu√≠mica. Genera una pregunta de pr√°ctica (Problema de c√°lculo de voltaje O pregunta de Leyes de Faraday O pregunta de definici√≥n de Pila/Electr√≥lisis/√Ånodo/C√°todo) de nivel intermedio. Proporciona la pregunta primero y, en la √∫ltima l√≠nea, a√±ade la respuesta precedida por: **Respuesta:**. Utiliza KaTeX para cualquier f√≥rmula matem√°tica (Ej: $E^\\circ_{\\text{celda}}$). Aseg√∫rate de incluir los datos necesarios para el c√°lculo, si aplica.`;

                    const userQuery = "Genera una pregunta de electroqu√≠mica para practicar, cubriendo REDOX, Faraday o c√°lculo de voltaje de celda.";
                    
                    try {
                        const resultText = await callGeminiApi(systemPrompt, userQuery);
                        quizResult.innerHTML = resultText;
                        renderMath(quizResult);
                    } catch (error) {
                        quizResult.innerHTML = "<p class='text-warning'>Error al generar la pregunta. Revisa la consola o el aviso de la IA.</p>";
                    } finally {
                        generateRedoxQuizBtn.disabled = false;
                    }
                });
            }

            // --- 3. L√≥gica del Calculador de F√≥rmulas Emp√≠ricas con IA ---
            const calculateEmpiricalBtn = document.getElementById('calculateEmpiricalBtn');
            const empiricalFormulaInput = document.getElementById('empiricalFormulaInput');
            const empiricalResult = document.getElementById('empiricalResult');

            if (calculateEmpiricalBtn) {
                calculateEmpiricalBtn.addEventListener('click', async () => {
                    const input = empiricalFormulaInput.value.trim();
                    if (!input) {
                        empiricalResult.innerHTML = "<p class='text-warning'>Por favor, introduce porcentajes y elementos (Ej: 40.9%C, 4.59%H, ...).</p>";
                        return;
                    }

                    empiricalResult.innerHTML = `<p class='text-darkblue'>Analizando proporciones para **F√≥rmula Emp√≠rica**... </p>`;
                    calculateEmpiricalBtn.disabled = true;

                    const systemPrompt = `Act√∫a como un experto en estequiometr√≠a. Tu tarea es recibir una lista de porcentajes elementales y, asumiendo una muestra de 100g, calcular la F√≥rmula Emp√≠rica (FE) de ese compuesto. Proporciona la respuesta y el procedimiento paso a paso. Si el usuario proporciona la masa molar, calcula tambi√©n la F√≥rmula Molecular (FM). Los pesos at√≥micos a usar son (aproximados): C=12, H=1, O=16, N=14. Utiliza formato de lista para el procedimiento.`;

                    const userQuery = `Calcula la f√≥rmula emp√≠rica y molecular (si se proporciona la masa molar) del compuesto con la siguiente composici√≥n: ${input}`;
                    
                    try {
                        const resultText = await callGeminiApi(systemPrompt, userQuery);
                        empiricalResult.innerHTML = resultText;
                        renderMath(empiricalResult);
                    } catch (error) {
                        empiricalResult.innerHTML = "<p class='text-warning'>Error al calcular. Revisa la consola o el aviso de la IA.</p>";
                    } finally {
                        calculateEmpiricalBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html>
